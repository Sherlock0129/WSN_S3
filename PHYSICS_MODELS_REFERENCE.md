# WSN_S3 物理模型与参数参考手册

## 📡 RF远场传播模型

### 1. Close-In (CI) 路径损耗模型

这是系统中最重要的RF传播模型。

#### 公式

```
PL(d) [dB] = FSPL(f, d₀) + 10·n·log₁₀(d/d₀) + X_σ
```

其中：
- **FSPL(f, d₀)** = 参考距离d₀处的自由空间路径损耗
- **n** = 路径损耗指数（LoS或NLoS）
- **d** = 实际传输距离
- **X_σ** = 阴影衰落（可选，默认0）

#### 自由空间路径损耗 (FSPL)

```
FSPL(f, d₀) [dB] = 20·log₁₀(f) + 20·log₁₀(d₀) - 147.55
```

其中：
- **f** = 频率 (Hz)
- **d₀** = 参考距离 (m)

#### 接收功率

```
P_rx [dBm] = P_tx [dBm] + G_tx [dBi] + G_rx [dBi] - PL(d)
```

转换为瓦特：
```
P_rx [W] = 10^((P_rx [dBm] - 30) / 10)
```

### 2. 参数配置

#### 环境参数 (EnvConfig)

```python
REFERENCE_DISTANCE = 1.0              # d₀ = 1米
PATH_LOSS_EXPONENT_LOS = 1.5          # n_LoS (良好视距)
PATH_LOSS_EXPONENT_NLOS = 3.5         # n_NLoS (非视距)
NLOS_EXTRA_LOSS_DB = 0.0              # 额外NLoS损耗
```

#### RF发射机参数 (SinkConfig)

```python
TRANSMIT_POWER_W = 10.0               # P_tx = 10 W = 40 dBm
FREQUENCY_HZ = 100e6                  # f = 100 MHz
ANTENNA_GAIN_DBI = 18.0               # G_tx = 18 dBi
```

#### 簇头接收参数 (ClusterHeadConfig)

```python
RF_RX_GAIN_DBI = 9.0                  # G_rx = 9 dBi
```

### 3. 计算示例

#### 场景设置

```
RF发射机:
  位置: (0, 0, 100) m
  功率: 10 W (40 dBm)
  频率: 100 MHz
  增益: 18 dBi

簇头:
  位置: (1000, 1000, 100) m
  增益: 9 dBi
  
环境: LoS (视距)
```

#### 计算步骤

```
1. 计算距离
   d = √((1000-0)² + (1000-0)² + (100-100)²)
     = √(2,000,000)
     = 1414.2 m

2. 计算FSPL(f, d₀)
   FSPL = 20·log₁₀(100e6) + 20·log₁₀(1) - 147.55
        = 20·8 + 0 - 147.55
        = 160 - 147.55
        = 12.45 dB

3. 计算路径损耗
   PL = 12.45 + 10·1.5·log₁₀(1414.2/1)
      = 12.45 + 15·log₁₀(1414.2)
      = 12.45 + 15·3.15
      = 12.45 + 47.25
      = 59.7 dB

4. 计算接收功率
   P_rx [dBm] = 40 + 18 + 9 - 59.7
              = 7.3 dBm
   
   P_rx [W] = 10^((7.3-30)/10)
            = 10^(-2.27)
            = 0.0054 W
            = 5.4 mW

5. 接收能量 (1秒)
   E_rx = 0.0054 * 1.0 = 0.0054 J
```

#### 距离影响分析

```
距离 (m)  | PL (dB) | P_rx (dBm) | P_rx (W) | E_rx (J/s)
----------|---------|------------|----------|----------
100       | 32.45   | 27.3       | 0.537 W  | 0.537 J
500       | 52.45   | 7.3        | 5.4 mW   | 0.0054 J
1000      | 59.7    | 0.0        | 1.0 mW   | 0.001 J
2000      | 66.95   | -7.25      | 0.19 mW  | 0.00019 J
5000      | 79.45   | -19.75     | 0.01 mW  | 0.00001 J
```

**观察：** 功率随距离的平方反比衰减（LoS情况下）。

---

## 🔄 RIS反射增益模型

### 1. RIS基本参数

#### 物理参数 (RISConfig)

```python
NUM_ELEMENTS_H = 16                   # 水平单元数
NUM_ELEMENTS_V = 16                   # 竖直单元数
TOTAL_ELEMENTS = 256                  # 总单元数
ELEMENT_SPACING_FACTOR = 0.5          # d = 0.5·λ
PHASE_RESOLUTION_BITS = 3             # 3比特量化 (8级)
```

#### 波长计算

```
λ = c / f
  = 3×10⁸ / 100×10⁶
  = 3 m

单元间距:
d = 0.5 × 3 = 1.5 m
```

### 2. RIS反射增益

#### 公式

```
G_RIS [dBi] = 10·log₁₀(4π·A_aperture / λ²)
```

其中：
- **A_aperture** = 孔径面积 = N·d²
- **N** = 总单元数 = 256
- **d** = 单元间距 = 1.5 m
- **λ** = 波长 = 3 m

#### 计算

```
A_aperture = 256 × 1.5²
           = 256 × 2.25
           = 576 m²

G_RIS = 10·log₁₀(4π × 576 / 3²)
      = 10·log₁₀(4π × 576 / 9)
      = 10·log₁₀(4π × 64)
      = 10·log₁₀(804.2)
      = 10 × 2.906
      = 29.06 dBi
```

**结论：** RIS提供约29 dBi的反射增益，相当于功率放大约800倍。

### 3. RIS相位配置

#### 波束成形原理

```
对于RIS单元(m,n)，计算相位以对齐反射信号：

φ_mn = (2π/λ) × (d_in + d_out)

其中：
- d_in = ||element(m,n) - source||
- d_out = ||element(m,n) - target||
```

#### 相位量化

```
量化级数: 2^3 = 8级
量化步长: 2π/8 = π/4 = 45°

原始相位: φ_mn (连续)
量化相位: round(φ_mn × 8 / (2π)) × (2π/8)
```

#### 示例

```
原始相位: 1.5 rad
量化: round(1.5 × 8 / (2π)) × (π/4)
    = round(1.5 × 8 / 6.28) × 0.785
    = round(1.91) × 0.785
    = 2 × 0.785
    = 1.57 rad (π/2)

量化误差: |1.5 - 1.57| = 0.07 rad ≈ 4°
```

### 4. RIS辅助功率计算

#### 两跳模型

```
RF_Tx ──(Hop1)──► RIS ──(Hop2)──► CH
```

#### Hop 1: RF → RIS

```
P_at_RIS [dBm] = P_tx [dBm] + G_tx [dBi] + 0 [dBi] - PL₁(d₁)
```

其中：
- RIS作为接收端，增益为0（等向天线）
- d₁ = ||RF_pos - RIS_pos||

#### Hop 2: RIS → CH

```
P_rx [dBm] = P_at_RIS [dBm] + G_RIS [dBi] + G_rx [dBi] - PL₂(d₂)
```

其中：
- RIS作为发射端，增益为G_RIS ≈ 29 dBi
- d₂ = ||RIS_pos - CH_pos||

#### 完整示例

```
假设:
  RF → RIS 距离: 500 m (LoS)
  RIS → CH 距离: 300 m (LoS)

计算:
  1. Hop1 路径损耗
     PL₁ = 12.45 + 10×1.5×log₁₀(500)
         = 12.45 + 15×2.70
         = 12.45 + 40.5
         = 52.95 dB
  
  2. RIS处接收功率
     P_at_RIS = 40 + 18 + 0 - 52.95
              = 5.05 dBm
              = 1.27 mW
  
  3. Hop2 路径损耗
     PL₂ = 12.45 + 10×1.5×log₁₀(300)
         = 12.45 + 15×2.48
         = 12.45 + 37.2
         = 49.65 dB
  
  4. CH处接收功率
     P_rx = 5.05 + 29 + 9 - 49.65
          = -6.6 dBm
          = 0.22 mW

对比直射 (1414.2 m):
  P_rx = 7.3 dBm = 5.4 mW
  
RIS方案: 0.22 mW (较弱)
直射方案: 5.4 mW (更强)

原因: RIS增益(29dBi)不足以补偿两跳总损耗增加
```

---

## 🧲 MRC近场传输模型

### 1. 模型公式

```
η(d) = η₀ × (d_ref / d)^γ
P_rx = P_tx × η(d)
```

其中：
- **η₀** = 参考效率 = 0.8 (1米处)
- **d_ref** = 参考距离 = 1.0 m
- **γ** = 衰减指数 = 3.0
- **d** = 实际距离

### 2. 参数配置

```python
ref_distance = 1.0                    # 1米
ref_efficiency = 0.8                  # 80%效率
decay_exponent = 3.0                  # d³衰减
```

### 3. 计算示例

#### 距离影响

```
距离 (m) | η(d)      | P_rx (W)   | E_rx (J/s)
---------|-----------|------------|----------
0.5      | 6.4       | 0.64 W     | 0.64 J
1.0      | 0.8       | 0.08 W     | 0.08 J
2.0      | 0.1       | 0.01 W     | 0.01 J
5.0      | 0.0064    | 0.00064 W  | 0.00064 J
10.0     | 0.0008    | 0.00008 W  | 0.00008 J
30.0     | 0.0000296 | 0.00000296 W | 0.00000296 J
```

**观察：** 效率随距离的立方反比衰减，近距离传输才有效。

#### 实际场景

```
传感器→簇头 MRC传输:
  发射功率: 0.1 W
  距离: 30 m
  
  η(30) = 0.8 × (1/30)³ = 2.96×10⁻⁵
  P_rx = 0.1 × 2.96×10⁻⁵ = 2.96×10⁻⁶ W
  E_rx = 2.96×10⁻⁶ J (极小，可忽略)

簇头→传感器 MRC传输:
  发射功率: 0.5 W
  距离: 5 m
  
  η(5) = 0.8 × (1/5)³ = 0.0064
  P_rx = 0.5 × 0.0064 = 0.0032 W
  E_rx = 0.0032 J (可接受)
```

---

## ☀️ 太阳能采集模型

### 1. 日照周期模型

```
太阳辐照度 G(t):
  - 日出: 6:00 (t=360分钟)
  - 日落: 18:00 (t=1080分钟)
  - 正午: 12:00 (t=720分钟)
  
G(t) = G_max × sin(π × (t-360) / 720)  [360 ≤ t ≤ 1080]
G(t) = 0                                [其他时间]
```

### 2. 参数配置

```python
G_max = 800.0                         # 最大太阳辐照度 (W/m²)
solar_efficiency = 0.18               # 太阳能电池效率
solar_area = 0.001                    # 太阳能板面积 (m²)
env_correction_factor = 0.6           # 环境修正因子
```

### 3. 采集功率计算

```
P_harvest [W] = η_solar × A_solar × G(t) × f_env
              = 0.18 × 0.001 × G(t) × 0.6
              = 1.08×10⁻⁴ × G(t)
```

### 4. 计算示例

#### 不同时刻的采集

```
时刻        | t(分钟) | G(t)(W/m²) | P(W)    | E(J/s)
------------|---------|------------|---------|--------
6:00 (日出) | 360     | 0          | 0       | 0
9:00        | 540     | 692        | 0.0747  | 0.0747
12:00(正午) | 720     | 800        | 0.0864  | 0.0864
15:00       | 900     | 692        | 0.0747  | 0.0747
18:00(日落) | 1080    | 0          | 0       | 0
夜间        | 0-360   | 0          | 0       | 0
```

#### 日采集能量

```
日采集能量 = ∫₃₆₀¹⁰⁸⁰ P(t) dt

近似计算 (梯形法):
  平均功率 ≈ 0.0747 W (日出和日落时)
  + 0.0864 W (正午)
  / 2 ≈ 0.0806 W
  
  日采集时间 = 12小时 = 43200秒
  日采集能量 = 0.0806 × 43200 ≈ 3482 J

精确计算 (积分):
  E = ∫₃₆₀¹⁰⁸⁰ 1.08×10⁻⁴ × 800 × sin(π(t-360)/720) dt
    = 86.4 × ∫₀⁷²⁰ sin(πu/720) du  (u = t-360)
    = 86.4 × [-720/π × cos(πu/720)]₀⁷²⁰
    = 86.4 × 720/π × [cos(0) - cos(π)]
    = 86.4 × 720/π × 2
    = 39,916 J ≈ 40 kJ
```

**结论：** 单个传感器每天采集约40 kJ的太阳能，足以维持基本运行。

---

## 🔋 能量消耗模型

### 1. 传感器上报能耗

```
E_tx = E_elec × B + ε_amp × B × d^τ
```

其中：
- **E_elec** = 电子学能耗 = 50 nJ/bit
- **ε_amp** = 放大器能耗 = 10 pJ/bit/m²
- **B** = 包大小 = 4000 bits
- **τ** = 路径损耗指数 = 2.0
- **d** = 传输距离 (m)

#### 配置参数

```python
REPORT_PACKET_BITS = 4000             # 4000 bits
REPORT_E_ELEC_J_PER_BIT = 50e-9       # 50 nJ/bit
REPORT_EPSILON_AMP_J_PER_BIT_MTAU = 10e-12  # 10 pJ/bit/m²
REPORT_PATH_LOSS_EXPONENT = 2.0       # τ = 2
```

#### 计算示例

```
距离: d = 30 m

E_elec = 50e-9 × 4000 = 200e-6 J = 200 μJ
E_amp = 10e-12 × 4000 × 30² = 36e-6 J = 36 μJ
E_tx = 200 + 36 = 236 μJ

距离: d = 100 m
E_amp = 10e-12 × 4000 × 100² = 400e-6 J = 400 μJ
E_tx = 200 + 400 = 600 μJ
```

### 2. 空闲功耗

```
E_idle = P_idle × Δt
```

其中：
- **P_idle** = 空闲功率 = 0.0 W (默认禁用)
- **Δt** = 时间步长 = 1.0 s

### 3. 传感能耗

```
E_sensing = 50 μJ (每次采样)
```

---

## 📊 参数对比表

### RF vs MRC vs 太阳能

```
特性          | RF远场      | MRC近场      | 太阳能
--------------|-------------|-------------|----------
频率          | 100 MHz     | 13.56 MHz   | 无
功率密度      | 中等        | 低          | 高
距离衰减      | d²(LoS)     | d³          | 无
最大距离      | 1000+ m     | 10 m        | 无限
效率          | 低(%)       | 中(%)       | 高(18%)
应用场景      | 远距离充电  | 近距离下发  | 全天采集
```

### 能量消耗速率对比

```
操作                | 功率    | 持续时间 | 总消耗
--------------------|---------|---------|--------
RF发射              | 10 W    | 1 s     | 10 J
簇头MRC发射         | 0.5 W   | 1 s     | 0.5 J
传感器MRC发射       | 0.1 W   | 1 s     | 0.1 J
传感器上报          | 0.0003 J| 1次/h   | 0.0003 J
太阳能采集 (正午)   | 0.0864 W| 1 s     | 0.0864 J
```

---

## 🎯 关键参数速查

### 距离相关的功率衰减

```
RF (LoS, 100 MHz):
  P(d) = P₀ × (d₀/d)²
  P₀ = 5.4 mW @ 1414 m
  
MRC (30 m):
  P(d) = P₀ × (d₀/d)³
  P₀ = 0.1 W @ 30 m
  P(d) = 0.1 × (1/30)³ = 2.96 μW
```

### 能量平衡临界点

```
传感器 (有太阳能):
  日采集: 40 kJ
  日消耗: 0.0003 × 24 = 0.0072 J (上报)
  净增: +40 kJ (能量充足)

传感器 (无太阳能):
  日采集: 0 J
  日消耗: 0.0072 J
  净增: -0.0072 J (能量枯竭)

簇头:
  日采集: 0.0054 × 86400 = 466 J (RF, 假设全天)
  日消耗: 0.5 × 86400 = 43200 J (MRC)
  净增: -42734 J (能量枯竭)
```

**结论：** 系统需要更高的RF功率或更优的路由策略。

---

## 📝 模型验证建议

1. **RF模型验证**：与实测的RF功率对比
2. **RIS模型验证**：与RIS制造商的规格对比
3. **MRC模型验证**：与磁共振耦合的理论对比
4. **太阳能模型验证**：与气象数据对比
5. **能量消耗验证**：与硬件数据表对比

---

## 🔗 参考文献

- Friis transmission equation: IEEE Trans. Antennas Propag., 1946
- Close-In path loss model: IEEE 802.11ax, 2021
- RIS beamforming: IEEE Trans. Wireless Commun., 2020
- Magnetic resonant coupling: IEEE Trans. Power Electron., 2013
- Solar irradiance model: ASHRAE Standard 93, 2010





